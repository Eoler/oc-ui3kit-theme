if(void 0===window.jQuery)throw new Error("The jQuery library is not loaded! The October CMS framework cannot be initialized.");if(void 0!==window.jQuery.request)throw new Error("The October CMS framework is already loaded!");(w=>{function y(r,a,i){var s=this.$el=w(r);if(this.options=i||{},void 0===a)throw new Error("The request handler name is not specified.");if(!a.match(/^(?:\w+\:{2})?on*/))throw new Error('Invalid handler name. The correct handler name format is: "onEvent".');var d={handler:a,options:i},o=(s.trigger("ajaxSetup",[d]),i.form?w(i.form):s.closest("form")),l=o.length?o:s;if(void 0!==i.browserValidate&&"function"==typeof document.createElement("input").reportValidity&&o.length&&!o.get(0).checkValidity())return o.get(0).reportValidity(),!1;var e=jQuery.Event("oc.beforeRequest");if(l.trigger(e,d),!e.isDefaultPrevented()){var n=void 0!==i.loading?i.loading:null,e=void 0!==i.url?i.url:window.location.href,u=void 0!==i.redirect&&i.redirect.length,c=void 0!==i.flash,t=void 0!==i.files,f=(t&&"undefined"==typeof FormData&&(console.warn("This browser does not support file uploads via FormData"),t=!1),"string"==w.type(n)&&(n=w(n)),{"X-OCTOBER-REQUEST-HANDLER":a,"X-OCTOBER-REQUEST-PARTIALS":this.extractPartials(i.update)}),h=(c&&(f["X-OCTOBER-REQUEST-FLASH"]=1),(()=>{var e=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),r=0;r<t.length;r++){var a=jQuery.trim(t[r]);if("XSRF-TOKEN="==a.substring(0,11)){e=decodeURIComponent(a.substring(11));break}}return e})());h&&(f["X-XSRF-TOKEN"]=h);var p,g,v={},m=(w.each(s.parents("[data-request-data]").toArray().reverse(),function(){w.extend(v,b("data-request-data",w(this).data("request-data")))}),s.is(":input")&&!o.length&&void 0!==(g=s.attr("name"))&&void 0===i.data[g]&&(i.data[g]=s.val()),void 0===i.data||w.isEmptyObject(i.data)||w.extend(v,i.data),t?(p=new FormData(o.length?o.get(0):void 0),s.is(":file")&&g&&(w.each(s.prop("files"),function(){p.append(g,this)}),delete v[g]),w.each(v,function(e){p.append(e,this)})):p=[o.serialize(),w.param(v)].filter(Boolean).join("&"),{url:e,crossDomain:!1,global:i.ajaxGlobal,context:d,headers:f,success:function(e,t,r){if(!1!==i.beforeUpdate.apply(d,[e,t,r])&&(!i.evalBeforeUpdate||!1!==w.proxy(new Function("data",i.evalBeforeUpdate),s.get(0))(e))){var a=jQuery.Event("ajaxBeforeUpdate");if(l.trigger(a,[d,e,t,r]),!a.isDefaultPrevented())return c&&e.X_OCTOBER_FLASH_MESSAGES&&w.each(e.X_OCTOBER_FLASH_MESSAGES,function(e,t){m.handleFlashMessage(t,e)}),(a=m.handleUpdateResponse(e,t,r)).done(function(){l.trigger("ajaxSuccess",[d,e,t,r]),i.evalSuccess&&w.proxy(new Function("data",i.evalSuccess),s.get(0))(e),i.afterUpdate.apply(d,[e,t,r])}),a}},error:function(t,r,e){var a,n={},o=w.Deferred();if(!(void 0!==window.ocUnloading&&window.ocUnloading||"abort"==e))return u=!1,i.redirect=null,406==t.status&&t.responseJSON?(n=t.responseJSON,a=t.responseJSON.X_OCTOBER_ERROR_MESSAGE,o=m.handleUpdateResponse(n,r,t)):(a=t.responseText||t.statusText,o.resolve()),o.done(function(){s.data("error-message",a);var e=jQuery.Event("ajaxError");l.trigger(e,[d,a,r,t]),e.isDefaultPrevented()||i.evalError&&!1===w.proxy(new Function("data",i.evalError),s.get(0))(n)||m.handleErrorMessage(a)}),o},complete:function(e,t,r){l.trigger("ajaxComplete",[d,e,t,r]),i.evalComplete&&w.proxy(new Function("data",i.evalComplete),s.get(0))(e)},handleConfirmMessage:function(e){var t=jQuery.Event("ajaxConfirmMessage");return t.promise=w.Deferred(),void 0!==w(window).triggerHandler(t,[e])?(t.promise.done(function(){i.confirm=null,new y(r,a,i)}),!1):!t.isDefaultPrevented()&&e?confirm(e):void 0},handleErrorMessage:function(e){var t=jQuery.Event("ajaxErrorMessage");w(window).trigger(t,[e]),t.isDefaultPrevented()||e&&alert(e)},handleValidationMessage:function(e,t){l.trigger("ajaxValidation",[d,e,t]);var n=!0;w.each(t,function(e,t){var r=e.replace(/\.(\w+)/g,"[$1]"),a=("."+e).replace(/\.(\w+)/g,"[$1]"),r=['[name="'+r+'"]','[name="'+r+'[]"]','[name$="'+a+'"]','[name$="'+a+'[]"]'],a=o.find(r.join(", ")).filter(":enabled").first();0<a.length&&(r=jQuery.Event("ajaxInvalidField"),w(window).trigger(r,[a.get(0),e,t,n]),n)&&(r.isDefaultPrevented()||a.focus(),n=!1)})},handleFlashMessage:function(e,t){},handleRedirectResponse:function(e){window.location.assign(e),s.trigger("ajaxRedirect")},handleUpdateResponse:function(r,a,n){var e=w.Deferred().done(function(){for(var e in r){var t=i.update[e]||e;("string"==w.type(t)&&"!"==t.charAt(0)?w(t.substring(1)).replaceWith(r[e]):"string"==w.type(t)&&"@"==t.charAt(0)?w(t.substring(1)).append(r[e]):"string"==w.type(t)&&"^"==t.charAt(0)?w(t.substring(1)).prepend(r[e]):(w(t).trigger("ajaxBeforeReplace"),w(t).html(r[e]))).trigger("ajaxUpdate",[d,r,a,n])}setTimeout(function(){w(window).trigger("ajaxUpdateComplete",[d,r,a,n]).trigger("resize")},0)});return r.X_OCTOBER_REDIRECT&&(i.redirect=r.X_OCTOBER_REDIRECT,u=!0),u&&m.handleRedirectResponse(i.redirect),r.X_OCTOBER_ERROR_FIELDS&&m.handleValidationMessage(r.X_OCTOBER_ERROR_MESSAGE,r.X_OCTOBER_ERROR_FIELDS),r.X_OCTOBER_ASSETS?assetManager.load(r.X_OCTOBER_ASSETS,w.proxy(e.resolve,e)):e.resolve(),e}});if(t&&(m.processData=m.contentType=!1),d.success=m.success,d.error=m.error,d.complete=m.complete,(m=w.extend(m,i)).data=p,!i.confirm||m.handleConfirmMessage(i.confirm))return n&&n.show(),w(window).trigger("ajaxBeforeSend",[d]),s.trigger("ajaxPromise",[d]),w.ajax(m).fail(function(e,t,r){u||s.trigger("ajaxFail",[d,t,e]),n&&n.hide()}).done(function(e,t,r){u||s.trigger("ajaxDone",[d,e,t,r]),n&&n.hide()}).always(function(e,t,r){s.trigger("ajaxAlways",[d,e,t,r])})}}y.DEFAULTS={update:{},type:"POST",beforeUpdate:function(e,t,r){},afterUpdate:function(e,t,r){},evalBeforeUpdate:null,evalSuccess:null,evalError:null,evalComplete:null,ajaxGlobal:!1},y.prototype.extractPartials=function(e){var t,r=[];for(t in e)r.push(t);return r.join("&")};var e=w.fn.request;function b(t,e){if("object"==typeof(e=void 0===e?"":e))return e;try{return ocJSON("{"+e+"}")}catch(e){throw new Error("Error parsing the "+t+" attribute value. "+e)}}w.fn.request=function(e,t){var r=w(this).first(),a={evalBeforeUpdate:r.data("request-before-update"),evalSuccess:r.data("request-success"),evalError:r.data("request-error"),evalComplete:r.data("request-complete"),ajaxGlobal:r.data("request-ajax-global"),confirm:r.data("request-confirm"),redirect:r.data("request-redirect"),loading:r.data("request-loading"),flash:r.data("request-flash"),files:r.data("request-files"),browserValidate:r.data("browser-validate"),form:r.data("request-form"),url:r.data("request-url"),update:b("data-request-update",r.data("request-update")),data:b("data-request-data",r.data("request-data"))},a=(e=e||r.data("request"),w.extend(!0,{},y.DEFAULTS,a,"object"==typeof t&&t));return new y(r,e,a)},w.fn.request.Constructor=y,w.request=function(e,t){return w(document).request(e,t)},w.fn.request.noConflict=function(){return w.fn.request=e,this},w(document).on("change","select[data-request], input[type=radio][data-request], input[type=checkbox][data-request], input[type=file][data-request]",function(){w(this).request()}),w(document).on("click","a[data-request], button[data-request], input[type=button][data-request], input[type=submit][data-request]",function(e){if(e.preventDefault(),w(this).request(),w(this).is("[type=submit]"))return!1}),w(document).on("keydown","input[type=text][data-request], input[type=submit][data-request], input[type=password][data-request]",function(e){if("Enter"===e.key)return void 0!==this.dataTrackInputTimer&&window.clearTimeout(this.dataTrackInputTimer),w(this).request(),!1}),w(document).on("input","input[data-request][data-track-input]",function(e){var t,r=w(this),a=r.data("oc.lastvalue");!r.is("[type=email],[type=number],[type=password],[type=search],[type=text]")||void 0!==a&&a==this.value||(r.data("oc.lastvalue",this.value),void 0!==this.dataTrackInputTimer&&window.clearTimeout(this.dataTrackInputTimer),a=(a=w(this).data("track-input"))||300,(t=this).dataTrackInputTimer=window.setTimeout(function(){t.lastDataTrackInputRequest&&t.lastDataTrackInputRequest.abort(),t.lastDataTrackInputRequest=w(t).request()},a))}),w(document).on("submit","[data-request]",function(){return w(this).request(),!1}),window.onbeforeunload=function(){window.ocUnloading=!0},w(document).ready(function(){w(document).trigger("render")}),w(window).on("ajaxUpdateComplete",function(){w(document).trigger("render")}),w.fn.render=function(e){w(document).on("render",e)}})(window.jQuery),(()=>{function u(e,t,r){for(var a="",n=t;n<e.length;n++){if(r&&r===e[n])return a;if(!r&&(" "===e[n]||":"===e[n]))return a;a+=e[n],"\\"===e[n]&&n+1<e.length&&(a+=e[n+1],n++)}throw new Error("Broken JSON syntax near "+a)}function c(e,t){if('"'===e[t]||"'"===e[t]){for(var r=e[t],a=t+1;a<e.length;a++)if("\\"===e[a])r+=e[a],a+1<e.length&&(r+=e[a+1]),a++;else{if(e[a]===e[t])return{originLength:(r+=e[t]).length,body:r};r+=e[a]}throw new Error("Broken JSON string body near "+r)}if("t"===e[t]){if(e.indexOf("true",t)===t)return{originLength:"true".length,body:"true"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("f"===e[t]){if(e.indexOf("f",t)===t)return{originLength:"false".length,body:"false"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("n"===e[t]){if(e.indexOf("null",t)===t)return{originLength:"null".length,body:"null"};throw new Error("Broken JSON boolean body near "+e.substr(0,t+10))}if("-"===e[t]||"+"===e[t]||"."===e[t]||"0"<=e[t]&&e[t]<="9"){for(r="",a=t;a<e.length;a++){if(!("-"===e[a]||"+"===e[a]||"."===e[a]||"0"<=e[a]&&e[a]<="9"))return{originLength:r.length,body:r};r+=e[a]}throw new Error("Broken JSON number body near "+r)}if("{"!==e[t]&&"["!==e[t])throw new Error("Broken JSON body near "+e.substr(0<=t-5?t-5:0,50));for(var n=[e[t]],r=e[t],a=t+1;a<e.length;a++){if(r+=e[a],"\\"===e[a])a+1<e.length&&(r+=e[a+1]),a++;else if('"'===e[a])'"'===n[n.length-1]?n.pop():"'"!==n[n.length-1]&&n.push(e[a]);else if("'"===e[a])"'"===n[n.length-1]?n.pop():'"'!==n[n.length-1]&&n.push(e[a]);else if('"'!==n[n.length-1]&&"'"!==n[n.length-1])if("{"===e[a])n.push("{");else if("}"===e[a]){if("{"!==n[n.length-1])throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+r);n.pop()}else if("["===e[a])n.push("[");else if("]"===e[a]){if("["!==n[n.length-1])throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+r);n.pop()}if(!n.length)return{originLength:a-t,body:r}}throw new Error("Broken JSON "+("{"===e[t]?"object":"array")+" body near "+r)}function f(e){return" "===e||"\n"===e||"\t"===e}window.ocJSON=function(e){e=function e(t){if(!(t=t.trim()).length)throw new Error("Broken JSON object.");for(var r="";t&&","===t[0];)t=t.substr(1);if('"'===t[0]||"'"===t[0]){if(t[t.length-1]===t[0])for(var a='"',n=1;n<t.length;n++)if("\\"===t[n])"'"===t[n+1]?a+=t[n+1]:a=(a+=t[n])+t[n+1],n++;else{if(t[n]===t[0])return a+='"';'"'===t[n]?a+='\\"':a+=t[n]}throw new Error("Invalid string JSON object.")}if("true"===t||"false"===t)return t;if("null"===t)return"null";var o,i=parseFloat(t);if(!isNaN(i))return i.toString();if("{"===t[0]){for(var s,d="needKey",r="{",n=1;n<t.length;n++)if(!f(t[n]))if("needKey"!==d||'"'!==t[n]&&"'"!==t[n]){if("needKey"===d&&"\\"!==(o=t[n])[0]&&("a"<=o[0]&&o[0]<="z"||"A"<=o[0]&&o[0]<="Z"||"_"===o[0]||"0"<=o[0]&&o[0]<="9"||"$"===o[0]||255<o.charCodeAt(0)))r=(r+='"')+(s=u(t,n))+'"',n+=s.length-1,d="afterKey";else if("afterKey"===d&&":"===t[n])r+=":",d=":";else if(":"===d)n=n+(a=c(t,n)).originLength-1,r+=e(a.body),d="afterBody";else if("afterBody"===d||"needKey"===d){for(var l=n;","===t[l]||f(t[l]);)l++;if("}"===t[l]&&l===t.length-1){for(;","===r[r.length-1];)r=r.substr(0,r.length-1);return r+="}"}l!==n&&"{"!==r&&(r+=",",d="needKey",n=l-1)}}else r+='"'+(s=u(t,n+1,t[n]))+'"',n=n+s.length+1,d="afterKey";throw new Error("Broken JSON object near "+r)}if("["===t[0]){for(r="[",d="needBody",n=1;n<t.length;n++)if(" "!==t[n]&&"\n"!==t[n]&&"\t"!==t[n])if("needBody"===d)if(","===t[n])r+="null,";else{if("]"===t[n]&&n===t.length-1)return","===r[r.length-1]&&(r=r.substr(0,r.length-1)),r+="]";a=c(t,n),n=n+a.originLength-1,r+=e(a.body),d="afterBody"}else if("afterBody"===d)if(","===t[n])for(r+=",",d="needBody";","===t[n+1]||f(t[n+1]);)","===t[n+1]&&(r+="null,"),n++;else if("]"===t[n]&&n===t.length-1)return r+="]";throw new Error("Broken JSON array near "+r)}}(e);return JSON.parse(e)}})(),(l=>{function e(){var e=this;this.counter=0,this.indicator=l("<div/>").addClass("stripe-loading-indicator loaded").append(l("<div />").addClass("stripe")).append(l("<div />").addClass("stripe-loaded")),this.stripe=this.indicator.find(".stripe"),l(document).ready(function(){l(document.body).append(e.indicator)})}function i(e,t){var e=l.extend({},i.DEFAULTS,e),r=l(t),a=(l("body > p.flash-message").remove(),(r=0==r.length?l("<p />").addClass(e.class).html(e.text):r).addClass("flash-message fade").attr("data-control",null).on("click","button",o).on("click",o).append('<button type="button" class="close" aria-hidden="true">&times;</button>'),l(document.body).append(r),setTimeout(function(){r.addClass("in")},100),window.setTimeout(o,1e3*e.interval));function n(){r.remove()}function o(){window.clearInterval(a),r.removeClass("in"),l.support.transition&&r.hasClass("fade")?r.one(l.support.transition.end,n).emulateTransitionEnd(500):n()}}void 0===l.oc&&(l.oc={});var t="oc-loading";l(document).on("ajaxSetup","[data-request][data-request-flash]",function(e,t){t.options.handleErrorMessage=function(e){l.oc.flashMsg({text:e,class:"error"})},t.options.handleFlashMessage=function(e,t){l.oc.flashMsg({text:e,class:t})}}),l(document).on("ajaxValidation","[data-request][data-request-validate]",function(e,t,r,a){var n,o,i=l(this).closest("form"),s=l("[data-validate-error]",i),d=[];l.each(a,function(e,t){n=l('[data-validate-for="'+e+'"]',i),d=l.merge(d,t),n.length&&(n.text().length&&1!=n.data("emptyMode")||n.data("emptyMode",!0).text(t.join(", ")),n.addClass("visible"))}),(s=s.length?l("[data-validate-error]",i):s).length&&(a=l("[data-message]",s),s.addClass("visible"),a.length?(o=a.first(),l.each(d,function(e,t){o.clone().text(t).insertAfter(o)}),a.remove()):s.text(r)),i.one("ajaxError",function(e){e.preventDefault()})}),l(document).on("ajaxPromise","[data-request][data-request-validate]",function(){var e=l(this).closest("form");l("[data-validate-for]",e).removeClass("visible"),l("[data-validate-error]",e).removeClass("visible")}),l(document).on("ajaxPromise","[data-request]",function(){var e=l(this);void 0!==e.data("attach-loading")&&e.addClass(t).prop("disabled",!0),e.is("form")&&l("[data-attach-loading]",e).addClass(t).prop("disabled",!0)}).on("ajaxFail ajaxDone","[data-request]",function(){var e=l(this);void 0!==e.data("attach-loading")&&e.removeClass(t).prop("disabled",!1),e.is("form")&&l("[data-attach-loading]",e).removeClass(t).prop("disabled",!1)}),e.prototype.show=function(){this.counter++,this.stripe.after(this.stripe=this.stripe.clone()).remove(),1<this.counter||(this.indicator.removeClass("loaded"),l(document.body).addClass("oc-loading"))},e.prototype.hide=function(e){this.counter--,void 0!==e&&e&&(this.counter=0),this.counter<=0&&(this.indicator.addClass("loaded"),l(document.body).removeClass("oc-loading"))},l.oc.stripeLoadIndicator=new e,l(document).on("ajaxPromise","[data-request]",function(e){e.stopPropagation(),l.oc.stripeLoadIndicator.show();var t=l(this);l(window).one("ajaxUpdateComplete",function(){0===t.closest("html").length&&l.oc.stripeLoadIndicator.hide()})}).on("ajaxFail ajaxDone","[data-request]",function(e){e.stopPropagation(),l.oc.stripeLoadIndicator.hide()}),i.DEFAULTS={class:"success",text:"Default text",interval:5},void 0===l.oc&&(l.oc={}),l.oc.flashMsg=i,l(document).render(function(){l("[data-control=flash-message]").each(function(){l.oc.flashMsg(l(this).data(),this)})})})(window.jQuery);